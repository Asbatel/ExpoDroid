package malware.scanner.Fragments;


import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import org.json.JSONException;

import malware.scanner.R;
import malware.scanner.Tasks.JsonDataParser;
import malware.scanner.Utils.Constants;
import malware.scanner.Utils.SharedPreferencesUtils;


public class MalwareScoreFragment extends android.support.v4.app.Fragment {
    private View background_clean;
    private TextView score;

    public MalwareScoreFragment() {}


    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        View view = inflater.inflate(R.layout.fragment_malware_score, container, false);
        setAttributes(view);
        checkHash();
        return view;
    }

    private void checkHash() {
        try {
            String jsonResult = SharedPreferencesUtils.getJsonData(getContext());
            final int[] result = new JsonDataParser().ParseData(jsonResult);
            final double benignCount = result[0];
            final double malCount = result[1];
            if ((benignCount / malCount) < 0.2) // 20% as a threshold of VT API
            {
                background_clean.setBackgroundResource(R.drawable.clean_border_layout);
            } else {
                background_clean.setBackgroundResource(R.drawable.border_layout);
            }
            score.setText("" + result[0] + "/" + result[1]); // to be changed to json from Prefs
        } catch (JSONException e) {
            e.printStackTrace();
            Log.e(Constants.SCANNER_PREFIX, "Exception while parsing json!", e);
        }
    }

    private void setAttributes(View view) {
        score = (TextView) view.findViewById(R.id.score);
        background_clean = view.findViewById(R.id.score_zone);
    }

}
